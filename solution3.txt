To move from a static "Pipeline" to an "Agentic Solution," you need to shift the architecture from linear execution (Step A $\rightarrow$ Step B) to reasoning loops (Observe $\rightarrow$ Think $\rightarrow$ Act).Since the data requirements vary per PDF (e.g., one PDF is an invoice requiring "Total Amount," another is a technical drawing requiring "Part Dimensions"), the Agent needs to dynamically decide what to look for.Here is the Agentic Architecture design using Self-Hosted LLMs on AWS.I. The Core Concept: "Router-Retriever-Extractor"Instead of hardcoding one prompt, we introduce a "Controller Agent" (running on Amazon ECS/Fargate) that orchestrates the work.The Classifier (Router): Looks at the first page and decides: "What type of document is this?"The Schema Registry: A database that tells the agent what fields to extract based on the document type.The Worker (Extractor): The VLM (Qwen2.5-VL) that performs the actual extraction using the specific schema.The Critic (Validator): A self-reflection step that checks if the extracted data matches the expected format and retries if necessary.II. Updated Architecture DiagramIII. Implementation Details1. The "Brain": Agent Controller (Amazon ECS + LangGraph)We replace the simple Step Functions map state with a containerized application running LangGraph (or LangChain).Why ECS (Fargate)? Agentic workflows often require loops (e.g., "The extraction failed, let me retry with a different prompt"). Lambda has time limits and is stateless; a container is better for maintaining the "conversation" state during processing.The LLM for the Brain: You can host a lightweight "Reasoning LLM" (like Llama 3.1 8B) on the same SageMaker instance as your VLM, or on a small CPU instance, to handle the logic (routing/planning).2. The "Memory": Schema Registry (DynamoDB)You cannot prompt the LLM to "extract everything" because that yields noise. You need a Dynamic Schema Registry.Create a DynamoDB table called DocSchemas:DocType (PK)TargetFields (JSON)ExtractionInstructionInvoice_VendorA["InvoiceNum", "Total", "Date"]"Focus on the top right header."Tech_Spec_Sheet["Voltage", "Amperage", "Diagram_ID"]"Extract data from the bottom table."Unknown["Summary", "DocType_Hypothesis"]"Summarize the document to identify it."

The "Tools": SageMaker EndpointsThe Agent is given access to "Tools" via Python functions:tool_vision_extract(image_path, fields_list): Calls the Qwen2.5-VL SageMaker endpoint.tool_pdf_rasterize(pdf_path): Converts PDF to images.tool_lookup_schema(doc_category): Queries DynamoDB.IV. The Agentic Workflow (Step-by-Step)When a file lands in S3, the Agent (ECS Task) wakes up and executes this loop:Phase 1: Identification (The "Look" Step)Agent Thought: "I have a new file. I don't know what it is. Let me look at the first page."Action: Calls tool_pdf_rasterize $\rightarrow$ Calls tool_vision_extract with a generic prompt: "Classify this document type."Result: Model sees a logo and a table, returns: "Type: Technical_Spec_Sheet".Phase 2: Planning (The "Fetch" Step)Agent Thought: "Okay, it's a Technical Spec Sheet. What data do I need from this?"Action: Calls tool_lookup_schema("Technical_Spec_Sheet").Result: DynamoDB returns: Target: ["Voltage", "Dimensions", "Safety_Rating"].Phase 3: Extraction (The "Work" Step)Agent Thought: "I need to find Voltage and Dimensions. I will look at all pages."Action: Iterates through images, calling tool_vision_extract specifically asking for those fields.Prompt Sent to VLM: "Extract 'Voltage' and 'Dimensions' from this image. Return JSON."Phase 4: Self-Correction (The "Reflect" Step)Agent Thought: "I extracted Voltage: null. That seems wrong for a Spec Sheet. Let me zoom in on the bottom-left table and retry."Action: Re-crops image or adjusts prompt $\rightarrow$ Retries extraction.V. Updated Technology StackComponentServiceRole in Agentic WorkflowOrchestratorAmazon ECS (Fargate)Runs the Python Agent (LangGraph/LangChain).Reasoning ModelLlama 3.1 8B (SageMaker)The "Brain" that decides which tool to use.Vision ModelQwen2.5-VL (SageMaker)The "Eyes" that read the pixels (Tables/Charts).Memory/ConfigAmazon DynamoDBStores the Schema Registry (Rules for different PDFs).State StoreAmazon ElastiCache (Redis)Keeps track of the agent's "thought process" during execution.